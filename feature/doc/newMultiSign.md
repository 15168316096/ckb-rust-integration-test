       
# 多签功能测试用例

## 1. 多签基本功能测试用例

### 1.1 多签配置生成

**用例**: 验证 `MultisigConfig::new_with` 生成多签配置的正确性。

**输入**:
- 使用 `MultisigScript::V2`
- 多种 threshold 值（例如 1、2、n）
- `require_first_n` 参数的边界值（如 0 和最大值）
- 不同的参与者公钥哈希列表

**预期结果**:
- 正确生成对应的多签配置
- 验证配置中的 hash160 和生成的地址是否符合预期

### 1.2 多签地址生成

**用例**: 测试 `multisig_config.to_address` 方法。

**场景**:
- 使用不同的网络类型（主网、测试网）
- 验证生成的地址格式是否正确

**预期结果**:
- 地址符合多签规则，且与配置中的参与者和 threshold 一致

### 1.3 多签依赖加载

**用例**: 验证 `MultisigScript::V2.dep_group` 方法。

**场景**:
- 环境变量中设置了 `MULTISIG_V2_DEP_GROUP`
- 未设置环境变量时，加载默认依赖
- 在不同网络（主网、测试网、开发网络）中测试

**预期结果**:
- 能正确加载依赖，返回有效的 (code_hash, index)

### 1.4 多签脚本 ID 测试

**用例**: 测试 `MultisigScript::V2.script_id` 方法。

**场景**:
- 验证 code_hash 和 hash_type 是否符合预期
- 测试 `MultisigScript::Legacy` 的兼容性

**预期结果**:
- 返回正确的脚本 ID

## 2. 转账功能测试用例

### 2.1 简单转账

**用例**: 验证从多签地址向单一接收地址转账。

**场景**:
- 输入单一的多签地址
- 输出容量设置为合法值

**预期结果**:
- 交易生成成功，witness 包含正确的签名

### 2.2 多输出转账

**用例**: 测试从多签地址向多个地址转账。

**场景**:
- 多个输出地址，分别设置不同的容量
- 验证交易是否正确平衡

**预期结果**:
- 输出总容量与输入总容量一致（扣除手续费）
- 每个 output 的锁脚本正确

### 2.3 阈值签名测试

**用例**: 测试不同的 threshold 值对签名的影响。

**场景**:
- 设置 2-of-3 和 3-of-5 的多签配置
- 提供符合和不符合阈值的签名

**预期结果**:
- 符合阈值时解锁成功
- 不符合阈值时解锁失败

### 2.4 无效多签配置

**用例**: 测试无效的多签配置。

**场景**:
- 设置非法的 threshold 和 require_first_n 参数
- 提供与配置不匹配的签名

**预期结果**:
- 多签配置生成失败或解锁失败

## 3. 边界测试

### 3.1 参数边界

**测试 threshold 和 require_first_n 参数的极端值**:
- 最小值：0
- 最大值：参与者总数
- 验证生成的配置和交易是否正常

### 3.2 签名边界

- 验证当签名数量正好等于 threshold 时是否能解锁
- 验证额外提供无效签名时是否会影响解锁

## 4. 性能和兼容性

### 4.1 性能测试

**用例**: 测试在高输入/输出数量情况下的性能。

**场景**:
- 构造包含 100 个输入和 100 个输出的交易

**预期结果**:
- 交易构造时间和解锁时间在合理范围内

### 4.2 兼容性测试

**用例**: 验证 `MultisigScript::V2` 和 Legacy 的兼容性。

**场景**:
- 在同一交易中混合使用 `MultisigScript::V2` 和 Legacy

**预期结果**:
- 能正确解锁并完成交易